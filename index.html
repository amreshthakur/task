<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work Journal - Real Time Daily Dates</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        body.modal-open {
            overflow: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header-content {
            position: relative;
            z-index: 2;
        }
        
        h1 {
            font-size: 2.3rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            padding: 25px;
            gap: 25px;
        }
        
        @media (min-width: 768px) {
            .app-container {
                flex-direction: row;
            }
        }
        
        .calendar-section {
            flex: 1;
            background-color: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e1e8f0;
            min-height: 600px;
        }
        
        .calendar-section.full-view {
            flex: 2;
        }
        
        .notes-section {
            flex: 1.5;
            background-color: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e1e8f0;
            display: flex;
            flex-direction: column;
        }
        
        .section-title {
            color: #1a237e;
            font-size: 1.3rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e1e8f0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .month-year {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1a237e;
        }
        
        .nav-buttons {
            display: flex;
            gap: 8px;
        }
        
        .nav-btn {
            background-color: #3949ab;
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .nav-btn:hover {
            background-color: #303f9f;
            transform: scale(1.05);
        }
        
        .date-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
            background-color: #e8eaf6;
            border-radius: 8px;
            padding: 5px;
        }
        
        .date-toggle-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 600;
            border-radius: 6px;
            transition: all 0.3s;
        }
        
        .date-toggle-btn.active {
            background-color: #3949ab;
            color: white;
        }
        
        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-weight: 600;
            color: #5a6c7d;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e1e8f0;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }
        
        .calendar-day {
            height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            position: relative;
            border: 1px solid transparent;
            padding: 8px;
            overflow: hidden;
        }
        
        .calendar-day:hover {
            background-color: #e8eaf6;
            border-color: #3949ab;
            transform: translateY(-2px);
        }
        
        .current-month {
            color: #1a237e;
            background-color: white;
        }
        
        .other-month {
            color: #a0aec0;
            background-color: #f7fafc;
        }
        
        .today {
            background-color: #e3f2fd;
            color: #1976d2;
            font-weight: 600;
            border: 2px solid #1976d2;
        }
        
        .has-entries {
            background-color: #e8f5e9;
            color: #2e7d32;
            font-weight: 600;
        }
        
        .has-entries::after {
            content: "üìù";
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.8rem;
        }
        
        .selected-day {
            background-color: #3949ab;
            color: white;
            font-weight: 600;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(57, 73, 171, 0.3);
        }
        
        .selected-day.has-entries::after {
            color: white;
        }
        
        .primary-date {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .secondary-date {
            font-size: 0.75rem;
            color: #666;
            font-weight: 500;
            text-align: center;
            line-height: 1.2;
        }
        
        .entry-count {
            font-size: 0.65rem;
            margin-top: 4px;
            font-weight: 600;
            position: absolute;
            bottom: 5px;
            background-color: rgba(57, 73, 171, 0.1);
            padding: 2px 6px;
            border-radius: 10px;
        }
        
        /* All Entries Button */
        .all-entries-btn {
            margin-top: 20px;
            width: 100%;
            background: linear-gradient(90deg, #ff9800 0%, #f57c00 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .all-entries-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.3);
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            pointer-events: none;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }
        
        .modal {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(-30px);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.active .modal {
            transform: translateY(0);
        }
        
        .modal-header {
            background: linear-gradient(90deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }
        
        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .modal-body {
            padding: 20px;
            max-height: 65vh;
            overflow-y: auto;
        }
        
        .modal-date-info {
            background-color: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3949ab;
        }
        
        .modal-date-primary {
            font-size: 1.4rem;
            font-weight: 600;
            color: #1a237e;
            margin-bottom: 5px;
        }
        
        .modal-date-secondary {
            font-size: 1rem;
            color: #666;
        }
        
        .entries-list {
            margin-bottom: 20px;
        }
        
        .entries-title {
            font-size: 1.2rem;
            color: #1a237e;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e1e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .add-entry-btn {
            background-color: #3949ab;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .add-entry-btn:hover {
            background-color: #303f9f;
            transform: translateY(-2px);
        }
        
        .entry-item {
            background-color: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #4caf50;
            position: relative;
        }
        
        .entry-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .entry-type {
            background-color: #3949ab;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .entry-time {
            font-size: 0.85rem;
            color: #666;
        }
        
        .entry-content {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .entry-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .entry-btn {
            background: none;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        
        .edit-btn {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        
        .delete-btn {
            background-color: #ffebee;
            color: #d32f2f;
        }
        
        .entry-btn:hover {
            transform: translateY(-2px);
        }
        
        .no-entries {
            text-align: center;
            padding: 30px;
            color: #999;
            font-style: italic;
        }
        
        /* All Entries Modal */
        .all-entries-modal .modal-header {
            background: linear-gradient(90deg, #ff9800 0%, #f57c00 100%);
        }
        
        .all-entries-modal .modal {
            max-width: 800px;
        }
        
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #ff9800;
            box-shadow: 0 0 0 3px rgba(255, 152, 0, 0.1);
        }
        
        .filter-options {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background-color: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background-color: #ff9800;
            color: white;
            border-color: #ff9800;
        }
        
        .filter-btn:hover:not(.active) {
            background-color: #f5f5f5;
        }
        
        .all-entries-list {
            max-height: 50vh;
            overflow-y: auto;
        }
        
        .all-entry-item {
            background-color: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #4caf50;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .all-entry-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .all-entry-date {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }
        
        .all-entry-type {
            background-color: #3949ab;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .all-entry-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }
        
        .all-entry-preview {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
            display: -webkit-box;
            /* -webkit-line-clamp: 2; */
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Entry Form Modal */
        .entry-form-modal .modal {
            max-width: 600px;
            max-height: 85vh;
        }
        
        .entry-form-modal .modal-body {
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .entry-form-header {
            background: linear-gradient(90deg, #4caf50 0%, #2e7d32 100%);
        }
        
        .form-container {
            padding: 20px;
        }
        
        .form-date-info {
            background-color: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #4caf50;
        }
        
        .form-date-primary {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2e7d32;
            margin-bottom: 5px;
        }
        
        .form-date-secondary {
            font-size: 1rem;
            color: #666;
        }
        
        .form-title {
            font-size: 1.4rem;
            color: #1a237e;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }
        
        .form-select, .form-input, .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-select:focus, .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #3949ab;
            box-shadow: 0 0 0 3px rgba(57, 73, 171, 0.1);
        }
        
        .form-textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e1e8f0;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-size: 1rem;
        }
        
        .btn-primary {
            background-color: #3949ab;
            color: white;
        }
        
        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
        }
        
        .btn-success {
            background-color: #4caf50;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: none;
            max-width: 350px;
        }
        
        .notification.success {
            background-color: #4caf50;
            border-left: 4px solid #2e7d32;
        }
        
        .notification.error {
            background-color: #f44336;
            border-left: 4px solid #c62828;
        }
        
        .notification.info {
            background-color: #2196f3;
            border-left: 4px solid #0d47a1;
        }
        
        /* Nepali Date Display */
        .nepali-date-display {
            background-color: #fff3e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            text-align: center;
            border-left: 5px solid #ff9800;
            box-shadow: 0 5px 20px rgba(255, 152, 0, 0.15);
            position: relative;
            overflow: hidden;
        }
        
        .nepali-date-display h4 {
            color: #e65100;
            margin-bottom: 12px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .nepali-date-display .date-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
        }
        
        .nepali-date-display .date-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            border: 1px solid #ffcc80;
        }
        
        .nepali-date-display .date-label {
            font-weight: 600;
            color: #1a237e;
            min-width: 100px;
            text-align: right;
            font-size: 1rem;
        }
        
        .nepali-date-display .date-value {
            font-weight: 700;
            font-size: 1.3rem;
            color: #bf360c;
            text-align: left;
            min-width: 200px;
        }
        
        .nepali-date-display .english-date-value {
            font-weight: 700;
            font-size: 1.3rem;
            color: #1a237e;
            text-align: left;
            min-width: 200px;
        }
        
        .nepali-date-display .update-time {
            font-size: 0.85rem;
            color: #666;
            margin-top: 10px;
            font-style: italic;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .nepali-date-display .real-time-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4caf50;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        
        .footer {
            text-align: center;
            padding: 15px;
            color: #718096;
            font-size: 0.85rem;
            border-top: 1px solid #e1e8f0;
            background-color: #f8fafc;
        }
        
        @media (max-width: 768px) {
            .app-container {
                padding: 15px;
            }
            
            .calendar-section {
                padding: 15px;
            }
            
            .calendar-grid {
                gap: 5px;
            }
            
            .calendar-day {
                height: 70px;
                font-size: 0.9rem;
            }
            
            .primary-date {
                font-size: 1rem;
            }
            
            .secondary-date {
                font-size: 0.65rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .modal {
                width: 95%;
                max-height: 95vh;
            }
            
            .modal-header {
                padding: 15px;
            }
            
            .modal-body {
                padding: 15px;
                max-height: 75vh;
            }
            
            .entry-form-modal .modal-body {
                max-height: 80vh;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .filter-options {
                flex-direction: column;
            }
            
            .filter-btn {
                width: 100%;
                text-align: center;
            }
            
            .nepali-date-display {
                padding: 15px;
            }
            
            .nepali-date-display .date-container {
                gap: 8px;
            }
            
            .nepali-date-display .date-item {
                flex-direction: column;
                gap: 5px;
                text-align: center;
            }
            
            .nepali-date-display .date-label,
            .nepali-date-display .date-value,
            .nepali-date-display .english-date-value {
                min-width: auto;
                text-align: center;
            }
            
            .nepali-date-display .date-value,
            .nepali-date-display .english-date-value {
                font-size: 1.1rem;
            }
            
            .nepali-date-display .real-time-indicator {
                position: relative;
                top: auto;
                right: auto;
                margin-top: 10px;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1><i class="fas fa-calendar-alt"></i> Work Journal - Daily Date Updates</h1>
                <p class="subtitle">Track work activities with automatically updating Nepali (BS) and English (AD) dates</p>
            </div>

            <!-- Dynamic Date Display -->
            <div class="nepali-date-display" id="nepali-date-display">
                <span class="real-time-indicator">
                    <i class="fas fa-sync-alt fa-spin"></i> LIVE
                </span>
                <h4><i class="fas fa-calendar-day"></i> Today's Dates</h4>
                
                <div class="date-container">
                    <div class="date-item">
                        <span class="date-label">Nepali (BS):</span>
                        <span class="date-value" id="dynamicNepaliDate">Loading...</span>
                    </div>
                    <div class="date-item">
                        <span class="date-label">English (AD):</span>
                        <span class="english-date-value" id="dynamicEnglishDate">Loading...</span>
                    </div>
                </div>
                
                <div class="update-time" id="lastUpdateTime">
                    <i class="far fa-clock"></i> Last updated: Just now
                </div>
            </div>
        </header>
        
        <div class="app-container">
            <div class="calendar-section full-view">
                <h2 class="section-title"><i class="far fa-calendar-alt"></i> Calendar</h2>
                
                <div class="date-toggle" id="date-toggle">
                    <button class="date-toggle-btn active" id="english-date-btn">
                        <i class="fas fa-globe"></i> English (AD)
                    </button>
                    <button class="date-toggle-btn" id="nepali-date-btn">
                        <i class="fas fa-mountain"></i> Nepali (BS)
                    </button>
                </div>
                
                <div class="calendar-header">
                    <button class="nav-btn" id="prev-month" title="Previous month">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div class="month-year" id="current-month-year">Loading...</div>
                    <button class="nav-btn" id="next-month" title="Next month">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                
                <div class="weekdays" id="weekdays">
                    <!-- Weekdays will be populated by JavaScript -->
                </div>
                
                <div class="calendar-grid" id="calendar-grid">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
                
                <!-- All Entries Button -->
                <button class="all-entries-btn" id="allEntriesBtn">
                    <i class="fas fa-list"></i> View All Entries
                </button>
            </div>
        </div>
        
        <div class="footer">
            <p>
                <i class="fas fa-info-circle"></i> 
                <strong>Daily Updates:</strong> Both Nepali (BS) and English (AD) dates update automatically every day at midnight.
            </p>
            <p>
                <i class="fas fa-database"></i> 
                <strong>Local Storage:</strong> All entries are saved in your browser and available when you return.
            </p>
        </div>
    </div>

    <!-- Date Modal -->
    <div class="modal-overlay" id="dateModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Date Details</h3>
                <button class="modal-close" id="modalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="modal-date-info">
                    <div class="modal-date-primary" id="modalDatePrimary">Loading...</div>
                    <div class="modal-date-secondary" id="modalDateSecondary">Loading...</div>
                </div>
                
                <div class="entries-list">
                    <h4 class="entries-title">
                        <span>Entries for this day</span>
                        <button class="add-entry-btn" id="showEntryFormBtn">
                            <i class="fas fa-plus"></i> Add Entry
                        </button>
                    </h4>
                    <div id="entriesContainer">
                        <!-- Entries will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- All Entries Modal -->
    <div class="modal-overlay all-entries-modal" id="allEntriesModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-list"></i> All Entries</h3>
                <button class="modal-close" id="allEntriesClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="search-box">
                    <input type="text" class="search-input" id="searchAllEntries" placeholder="Search entries...">
                </div>
                
                <div class="filter-options">
                    <button class="filter-btn active" data-filter="all">All Entries</button>
                    <button class="filter-btn" data-filter="work">Work</button>
                    <button class="filter-btn" data-filter="dream">Dream</button>
                    <button class="filter-btn" data-filter="achievement">Achievement</button>
                    <button class="filter-btn" data-filter="note">Note</button>
                    <button class="filter-btn" data-filter="reminder">Reminder</button>
                    <button class="filter-btn" data-filter="challenge">Challenge</button>
                    <button class="filter-btn" data-filter="learning">Learning</button>
                </div>
                
                <div class="all-entries-list" id="allEntriesList">
                    <!-- All entries will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Entry Form Modal -->
    <div class="modal-overlay entry-form-modal" id="entryFormModal">
        <div class="modal">
            <div class="modal-header entry-form-header">
                <h3 class="modal-title" id="entryFormTitle">Add New Entry</h3>
                <button class="modal-close" id="entryFormClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-container">
                    <div class="form-date-info">
                        <div class="form-date-primary" id="formDatePrimary">Loading...</div>
                        <div class="form-date-secondary" id="formDateSecondary">Loading...</div>
                    </div>
                    
                    <form id="entryForm">
                        <div class="form-group">
                            <label class="form-label">Entry Type</label>
                            <select class="form-select" id="entryType">
                                <option value="work">Work / Task</option>
                                <option value="dream">Dream / Goal</option>
                                <option value="achievement">Achievement</option>
                                <option value="note">Note / Thought</option>
                                <option value="reminder">Reminder</option>
                                <option value="challenge">Challenge</option>
                                <option value="learning">Learning</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-input" id="entryTitle" placeholder="Enter a title for your entry" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Details</label>
                            <textarea class="form-textarea" id="entryDetails" placeholder="Describe what you did, achieved, or thought about on this day..." required></textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelEntry">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                            <button type="submit" class="btn btn-success" id="saveEntry">
                                <i class="fas fa-save"></i> Save Entry
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification System -->
    <div class="notification" id="notification"></div>

    <script>
        // =================== COMPLETE DAILY DATE UPDATE SYSTEM ===================
        // Global date variables
        let TODAY = new Date(); // Real current date
        let currentDate = new Date(TODAY); // For calendar navigation
        let selectedDate = null; // Currently selected date
        let currentEntryId = null; // Currently editing entry ID
        let lastUpdateTime = null; // Track when dates were last updated
        
        // Calendar mode
        let calendarMode = 'english';
        
        // Data storage
        let entriesData = {};
        
        // Entry types
        const entryTypes = {
            'work': { name: 'Work / Task', color: '#3949ab', icon: 'fas fa-briefcase' },
            'dream': { name: 'Dream / Goal', color: '#9c27b0', icon: 'fas fa-cloud' },
            'achievement': { name: 'Achievement', color: '#4caf50', icon: 'fas fa-trophy' },
            'note': { name: 'Note / Thought', color: '#ff9800', icon: 'fas fa-sticky-note' },
            'reminder': { name: 'Reminder', color: '#f44336', icon: 'fas fa-bell' },
            'challenge': { name: 'Challenge', color: '#ff5722', icon: 'fas fa-exclamation-triangle' },
            'learning': { name: 'Learning', color: '#2196f3', icon: 'fas fa-graduation-cap' }
        };
        
        // Nepali months
        const nepaliMonths = [
            "‡§¨‡•à‡§∂‡§æ‡§ñ", "‡§ú‡•á‡§†", "‡§Ö‡§∏‡§æ‡§∞", "‡§∂‡•ç‡§∞‡§æ‡§µ‡§£", "‡§≠‡§¶‡•å", "‡§Ö‡§∏‡•ã‡§ú",
            "‡§ï‡§æ‡§∞‡•ç‡§§‡§ø‡§ï", "‡§Æ‡§Ç‡§∏‡§ø‡§∞", "‡§™‡•Å‡§∑", "‡§Æ‡§æ‡§ò", "‡§´‡§æ‡§ó‡•Å‡§®", "‡§ö‡•à‡§§‡•ç‡§∞"
        ];
        
        const englishMonths = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];
        
        const nepaliWeekdays = ["‡§Ü‡§á‡§§", "‡§∏‡•ã‡§Æ", "‡§Æ‡§Ç‡§ó‡§≤", "‡§¨‡•Å‡§ß", "‡§¨‡§ø‡§π‡•Ä", "‡§∂‡•Å‡§ï‡•ç‡§∞", "‡§∂‡§®‡§ø"];
        const englishWeekdays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        const englishWeekdaysFull = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        
        // Nepali numerals
        const nepaliNumerals = ['‡•¶', '‡•ß', '‡•®', '‡•©', '‡•™', '‡•´', '‡•¨', '‡•≠', '‡•Æ', '‡•Ø'];
        
        // =================== UPDATED NEPALI CALENDAR DATA (2023-2025) ===================
        const nepaliCalendarData = {
            // Current year 2081 BS (2024-2025 AD)
            2081: { 
                months: [31, 31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 31], 
                startDate: new Date(2024, 3, 13) // April 13, 2024
            },
            // Next year 2082 BS (2025-2026 AD)
            2082: { 
                months: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31], 
                startDate: new Date(2025, 3, 14) // April 14, 2025
            },
            // Previous year 2080 BS (2023-2024 AD)
            2080: { 
                months: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30], 
                startDate: new Date(2023, 3, 14) // April 14, 2023
            },
            // For testing: 2079 BS (2022-2023 AD)
            2079: { 
                months: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31], 
                startDate: new Date(2022, 3, 14) // April 14, 2022
            },
            // For testing: 2078 BS (2021-2022 AD)
            2078: { 
                months: [31, 31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 31], 
                startDate: new Date(2021, 3, 14) // April 14, 2021
            }
        };

        // =================== DOM ELEMENTS ===================
        const monthYearElement = document.getElementById('current-month-year');
        const calendarGridElement = document.getElementById('calendar-grid');
        const weekdaysElement = document.getElementById('weekdays');
        const dynamicNepaliDate = document.getElementById('dynamicNepaliDate');
        const dynamicEnglishDate = document.getElementById('dynamicEnglishDate');
        const lastUpdateTimeElement = document.getElementById('lastUpdateTime');
        const prevMonthButton = document.getElementById('prev-month');
        const nextMonthButton = document.getElementById('next-month');
        const englishDateBtn = document.getElementById('english-date-btn');
        const nepaliDateBtn = document.getElementById('nepali-date-btn');
        const notificationElement = document.getElementById('notification');
        const allEntriesBtn = document.getElementById('allEntriesBtn');
        
        // Date Modal Elements
        const dateModal = document.getElementById('dateModal');
        const modalClose = document.getElementById('modalClose');
        const modalDatePrimary = document.getElementById('modalDatePrimary');
        const modalDateSecondary = document.getElementById('modalDateSecondary');
        const entriesContainer = document.getElementById('entriesContainer');
        const showEntryFormBtn = document.getElementById('showEntryFormBtn');
        
        // All Entries Modal Elements
        const allEntriesModal = document.getElementById('allEntriesModal');
        const allEntriesClose = document.getElementById('allEntriesClose');
        const searchAllEntries = document.getElementById('searchAllEntries');
        const allEntriesList = document.getElementById('allEntriesList');
        const filterButtons = document.querySelectorAll('.filter-btn');
        
        // Entry Form Modal Elements
        const entryFormModal = document.getElementById('entryFormModal');
        const entryFormClose = document.getElementById('entryFormClose');
        const entryFormTitle = document.getElementById('entryFormTitle');
        const formDatePrimary = document.getElementById('formDatePrimary');
        const formDateSecondary = document.getElementById('formDateSecondary');
        const entryForm = document.getElementById('entryForm');
        const entryType = document.getElementById('entryType');
        const entryTitle = document.getElementById('entryTitle');
        const entryDetails = document.getElementById('entryDetails');
        const cancelEntry = document.getElementById('cancelEntry');
        const saveEntry = document.getElementById('saveEntry');

        // =================== UTILITY FUNCTIONS ===================
        
        function showNotification(message, type = 'info', duration = 3000) {
            notificationElement.textContent = message;
            notificationElement.className = `notification ${type}`;
            notificationElement.style.display = 'block';
            
            setTimeout(() => {
                notificationElement.style.display = 'none';
            }, duration);
        }
        
        function toNepaliNumerals(number) {
            return number.toString().split('').map(digit => {
                const num = parseInt(digit);
                return !isNaN(num) ? nepaliNumerals[num] : digit;
            }).join('');
        }
        
        function getDateKey(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        function parseDateKey(dateKey) {
            const [year, month, day] = dateKey.split('-').map(Number);
            return new Date(year, month - 1, day);
        }

        // =================== IMPROVED DATE CONVERSION FUNCTIONS ===================
        
        function getNepaliDateFromEnglish(englishDate) {
            const englishYear = englishDate.getFullYear();
            const englishMonth = englishDate.getMonth();
            const englishDay = englishDate.getDate();
            
            // Find the Nepali year that contains this English date
            for (let nepaliYear = 2078; nepaliYear <= 2082; nepaliYear++) {
                const yearData = nepaliCalendarData[nepaliYear];
                if (!yearData) continue;
                
                const startDate = new Date(yearData.startDate);
                
                // Calculate total days in this Nepali year
                let totalDays = 0;
                yearData.months.forEach(days => totalDays += days);
                
                const endDate = new Date(startDate);
                endDate.setDate(endDate.getDate() + totalDays);
                
                // Check if the English date falls within this Nepali year
                if (englishDate >= startDate && englishDate < endDate) {
                    const diffTime = englishDate.getTime() - startDate.getTime();
                    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                    
                    let remainingDays = diffDays;
                    let nepaliMonth = 0;
                    
                    // Find which Nepali month this day falls in
                    for (let m = 0; m < 12; m++) {
                        const daysInMonth = yearData.months[m];
                        if (remainingDays < daysInMonth) {
                            nepaliMonth = m + 1;
                            break;
                        }
                        remainingDays -= daysInMonth;
                    }
                    
                    const nepaliDay = remainingDays + 1;
                    
                    return {
                        year: nepaliYear,
                        month: nepaliMonth,
                        day: nepaliDay
                    };
                }
            }
            
            // If not found in the data, use approximation
            const approximateNepaliYear = englishYear + 57;
            return {
                year: approximateNepaliYear,
                month: englishMonth + 1,
                day: englishDay
            };
        }
        
        function getEnglishDateFromNepali(nepaliYear, nepaliMonth, nepaliDay) {
            const yearData = nepaliCalendarData[nepaliYear];
            if (!yearData) {
                // Use approximation if data not available
                const approximateEnglishYear = nepaliYear - 57;
                return new Date(approximateEnglishYear, nepaliMonth - 1, nepaliDay);
            }
            
            const startDate = new Date(yearData.startDate);
            let totalDays = 0;
            
            // Add days from previous months
            for (let m = 0; m < nepaliMonth - 1; m++) {
                totalDays += yearData.months[m];
            }
            
            // Add days from current month (subtract 1 because days start from 1)
            totalDays += (nepaliDay - 1);
            
            const englishDate = new Date(startDate);
            englishDate.setDate(englishDate.getDate() + totalDays);
            return englishDate;
        }
        
        function formatNepaliDate(nepaliDate) {
            if (!nepaliDate) return '';
            
            const nepaliYearStr = toNepaliNumerals(nepaliDate.year);
            const nepaliMonthStr = nepaliMonths[nepaliDate.month - 1] || `‡§Æ‡§π‡§ø‡§®‡§æ ${nepaliDate.month}`;
            const nepaliDayStr = toNepaliNumerals(nepaliDate.day);
            
            return `${nepaliMonthStr} ${nepaliDayStr}, ${nepaliYearStr}`;
        }
        
        function formatEnglishDate(englishDate) {
            const weekday = englishWeekdaysFull[englishDate.getDay()];
            const month = englishMonths[englishDate.getMonth()];
            const day = englishDate.getDate();
            const year = englishDate.getFullYear();
            
            return `${month} ${day}, ${year}, ${weekday}`;
        }
        
        function formatDateShort(date) {
            const month = englishMonths[date.getMonth()].substring(0, 3);
            const day = date.getDate();
            const year = date.getFullYear();
            return `${month} ${day}, ${year}`;
        }

        // =================== REAL-TIME DAILY DATE UPDATE SYSTEM ===================
        
        function updateBothDates() {
            // Get current real-time date
            const now = new Date();
            TODAY = new Date(now); // Store as new object
            lastUpdateTime = now;
            
            // Get accurate Nepali date
            const nepaliDate = getNepaliDateFromEnglish(TODAY);
            
            // Format dates
            const nepaliFormatted = formatNepaliDate(nepaliDate);
            const englishFormatted = formatEnglishDate(TODAY);
            
            // Update display elements
            dynamicNepaliDate.textContent = nepaliFormatted;
            dynamicEnglishDate.textContent = englishFormatted;
            
            // Update last update time
            const timeString = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit',
                hour12: true 
            });
            lastUpdateTimeElement.innerHTML = `<i class="far fa-clock"></i> Last updated: ${timeString}`;
            
            // Update document title
            document.title = `Work Journal - ${englishFormatted.split(',')[0]} (${nepaliFormatted})`;
            
            // Check if we need to update calendar (if showing current month)
            updateCalendarIfNeeded();
            
            // Check if we need to update modals
            updateModalsIfNeeded();
            
            // Check for date change (midnight)
            checkForDateChange();
            
            return { nepaliFormatted, englishFormatted };
        }
        
        function updateCalendarIfNeeded() {
            // Check if calendar is showing current month
            const currentMonth = TODAY.getMonth();
            const currentYear = TODAY.getFullYear();
            const displayedMonth = currentDate.getMonth();
            const displayedYear = currentDate.getFullYear();
            
            if (currentMonth === displayedMonth && currentYear === displayedYear) {
                // Re-render calendar to update today's highlight
                renderCalendar();
            }
        }
        
        function updateModalsIfNeeded() {
            // If today's date is selected in modal, update it
            if (selectedDate && 
                selectedDate.getDate() === TODAY.getDate() && 
                selectedDate.getMonth() === TODAY.getMonth() && 
                selectedDate.getFullYear() === TODAY.getFullYear()) {
                
                const nepaliDate = getNepaliDateFromEnglish(TODAY);
                const nepaliFormatted = formatNepaliDate(nepaliDate);
                const englishFormatted = formatEnglishDate(TODAY);
                
                if (dateModal.classList.contains('active')) {
                    modalDatePrimary.textContent = englishFormatted;
                    modalDateSecondary.textContent = nepaliFormatted;
                }
                
                if (entryFormModal.classList.contains('active')) {
                    formDatePrimary.textContent = englishFormatted;
                    formDateSecondary.textContent = nepaliFormatted;
                }
            }
        }
        
        function checkForDateChange() {
            // Check if date has changed since last update
            const storedDateKey = localStorage.getItem('lastStoredDate');
            const currentDateKey = getDateKey(TODAY);
            
            if (storedDateKey !== currentDateKey) {
                // Date has changed! Show notification
                const yesterday = new Date(TODAY);
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayNepali = getNepaliDateFromEnglish(yesterday);
                const yesterdayFormatted = formatNepaliDate(yesterdayNepali);
                
                const todayNepali = getNepaliDateFromEnglish(TODAY);
                const todayFormatted = formatNepaliDate(todayNepali);
                
                showNotification(
                    `New day! ${yesterdayFormatted} ‚Üí ${todayFormatted}`,
                    'info',
                    5000
                );
                
                // Store new date
                localStorage.setItem('lastStoredDate', currentDateKey);
                
                // Force calendar refresh
                renderCalendar();
            }
        }
        
        function startDailyDateUpdates() {
            // Initial update
            updateBothDates();
            
            // Store initial date
            localStorage.setItem('lastStoredDate', getDateKey(TODAY));
            
            // Update every 10 seconds for better accuracy
            setInterval(() => {
                updateBothDates();
            }, 10000); // 10 seconds
            
            // Set up midnight check
            scheduleMidnightUpdate();
            
            // Also update when page becomes visible (user returns to tab)
            document.addEventListener('visibilitychange', () => {
                if (!document.hidden) {
                    updateBothDates();
                }
            });
        }
        
        function scheduleMidnightUpdate() {
            const now = new Date();
            const millisecondsUntilMidnight = new Date(
                now.getFullYear(),
                now.getMonth(),
                now.getDate() + 1,
                0, 0, 0, 0
            ) - now;
            
            // Schedule update at midnight
            setTimeout(() => {
                updateBothDates();
                // Then check every 30 seconds after midnight
                setInterval(updateBothDates, 30000); // 30 seconds
            }, millisecondsUntilMidnight);
        }

        // =================== DATA STORAGE FUNCTIONS ===================
        
        function loadEntries() {
            try {
                const savedEntries = localStorage.getItem('workJournalEntries');
                if (savedEntries) {
                    entriesData = JSON.parse(savedEntries);
                } else {
                    entriesData = {};
                }
            } catch (e) {
                console.error("Error loading entries:", e);
                entriesData = {};
            }
        }
        
        function saveEntries() {
            try {
                localStorage.setItem('workJournalEntries', JSON.stringify(entriesData));
            } catch (e) {
                console.error("Error saving entries:", e);
                showNotification('Error saving entries', 'error');
            }
        }
        
        function getEntriesForDate(date) {
            const dateKey = getDateKey(date);
            return entriesData[dateKey] || [];
        }
        
        function getAllEntries() {
            const allEntries = [];
            
            for (const dateKey in entriesData) {
                const date = parseDateKey(dateKey);
                
                entriesData[dateKey].forEach(entry => {
                    allEntries.push({
                        dateKey: dateKey,
                        date: date,
                        ...entry
                    });
                });
            }
            
            return allEntries.sort((a, b) => new Date(b.date) - new Date(a.date));
        }
        
        function addEntryToDate(date, entry) {
            const dateKey = getDateKey(date);
            
            if (!entriesData[dateKey]) {
                entriesData[dateKey] = [];
            }
            
            entry.id = Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            entry.timestamp = new Date().toISOString();
            
            entriesData[dateKey].push(entry);
            saveEntries();
            
            return entry;
        }
        
        function updateEntryForDate(date, entryId, updatedEntry) {
            const dateKey = getDateKey(date);
            
            if (entriesData[dateKey]) {
                const index = entriesData[dateKey].findIndex(entry => entry.id === entryId);
                if (index !== -1) {
                    updatedEntry.id = entryId;
                    updatedEntry.timestamp = entriesData[dateKey][index].timestamp;
                    entriesData[dateKey][index] = updatedEntry;
                    saveEntries();
                    return true;
                }
            }
            
            return false;
        }
        
        function deleteEntryFromDate(date, entryId) {
            const dateKey = getDateKey(date);
            
            if (entriesData[dateKey]) {
                entriesData[dateKey] = entriesData[dateKey].filter(entry => entry.id !== entryId);
                
                if (entriesData[dateKey].length === 0) {
                    delete entriesData[dateKey];
                }
                
                saveEntries();
                return true;
            }
            
            return false;
        }
        
        function getEntryCountForDate(date) {
            const entries = getEntriesForDate(date);
            return entries.length;
        }

        // =================== MODAL FUNCTIONS ===================
        
        function showAllEntriesModal() {
            allEntriesModal.classList.add('active');
            document.body.classList.add('modal-open');
            loadAllEntries();
        }
        
        function closeAllEntriesModal() {
            allEntriesModal.classList.remove('active');
            document.body.classList.remove('modal-open');
            searchAllEntries.value = '';
            
            filterButtons.forEach(btn => {
                if (btn.dataset.filter === 'all') {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }
        
        function loadAllEntries(filterType = 'all', searchQuery = '') {
            const allEntries = getAllEntries();
            allEntriesList.innerHTML = '';
            
            if (allEntries.length === 0) {
                allEntriesList.innerHTML = `
                    <div class="no-entries">
                        <i class="fas fa-calendar-plus" style="font-size: 3rem; margin-bottom: 15px; color: #ccc;"></i>
                        <p>No entries yet.</p>
                        <p>Click on any date and add your first entry!</p>
                    </div>
                `;
                return;
            }
            
            const filteredEntries = allEntries.filter(entry => {
                if (filterType !== 'all' && entry.type !== filterType) {
                    return false;
                }
                
                if (searchQuery) {
                    const query = searchQuery.toLowerCase();
                    const titleMatch = entry.title.toLowerCase().includes(query);
                    const detailsMatch = entry.details.toLowerCase().includes(query);
                    return titleMatch || detailsMatch;
                }
                
                return true;
            });
            
            if (filteredEntries.length === 0) {
                allEntriesList.innerHTML = `
                    <div class="no-entries">
                        <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 15px; color: #ccc;"></i>
                        <p>No entries found.</p>
                        <p>Try a different search or filter.</p>
                    </div>
                `;
                return;
            }
            
            filteredEntries.forEach(entry => {
                const entryElement = document.createElement('div');
                entryElement.className = 'all-entry-item';
                entryElement.dataset.id = entry.id;
                entryElement.dataset.dateKey = entry.dateKey;
                
                const nepaliDate = getNepaliDateFromEnglish(entry.date);
                const entryTypeInfo = entryTypes[entry.type] || entryTypes.note;
                
                const entryTime = new Date(entry.timestamp);
                const timeString = entryTime.toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: true 
                });
                
                const dateString = calendarMode === 'english' 
                    ? formatDateShort(entry.date)
                    : formatNepaliDate(nepaliDate);
                
                const secondaryDate = calendarMode === 'english'
                    ? formatNepaliDate(nepaliDate)
                    : formatDateShort(entry.date);
                
                entryElement.innerHTML = `
                    <div class="all-entry-date">
                        <span><i class="far fa-calendar"></i> ${dateString}</span>
                        <span class="all-entry-type" style="background-color: ${entryTypeInfo.color}">
                            <i class="${entryTypeInfo.icon}"></i> ${entryTypeInfo.name}
                        </span>
                    </div>
                    <div class="all-entry-title">${entry.title}</div>
                    <div class="all-entry-preview">${entry.details.substring(0, 150)}${entry.details.length > 150 ? '...' : ''}</div>
                    <div style="font-size: 0.8rem; color: #999; margin-top: 8px;">
                        <i class="far fa-clock"></i> ${timeString}
                        <span style="margin-left: 15px;">${secondaryDate}</span>
                    </div>
                `;
                
                entryElement.addEventListener('click', () => {
                    closeAllEntriesModal();
                    setTimeout(() => {
                        showDateModal(entry.date);
                        
                        setTimeout(() => {
                            const entryElement = document.querySelector(`.entry-item[data-id="${entry.id}"]`);
                            if (entryElement) {
                                entryElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                entryElement.style.backgroundColor = '#e3f2fd';
                                entryElement.style.boxShadow = '0 0 0 2px #1976d2';
                                setTimeout(() => {
                                    entryElement.style.backgroundColor = '';
                                    entryElement.style.boxShadow = '';
                                }, 2000);
                            }
                        }, 500);
                    }, 300);
                });
                
                allEntriesList.appendChild(entryElement);
            });
        }
        
        function showEntryFormModal(isEditMode = false, entryId = null) {
            if (!selectedDate) {
                showNotification('Please select a date first', 'error');
                return;
            }
            
            currentEntryId = entryId;
            entryFormTitle.textContent = isEditMode ? 'Edit Entry' : 'Add New Entry';
            updateFormDateDisplay();
            resetEntryForm();
            
            if (isEditMode && entryId) {
                const entries = getEntriesForDate(selectedDate);
                const entry = entries.find(e => e.id === entryId);
                
                if (entry) {
                    entryType.value = entry.type;
                    entryTitle.value = entry.title;
                    entryDetails.value = entry.details;
                }
            }
            
            entryFormModal.classList.add('active');
            document.body.classList.add('modal-open');
            
            setTimeout(() => {
                entryTitle.focus();
            }, 300);
        }
        
        function closeEntryFormModal() {
            entryFormModal.classList.remove('active');
            document.body.classList.remove('modal-open');
            currentEntryId = null;
            resetEntryForm();
        }
        
        function resetEntryForm() {
            entryForm.reset();
            entryType.value = 'work';
        }
        
        function updateFormDateDisplay() {
            if (!selectedDate) return;
            
            const nepaliDate = getNepaliDateFromEnglish(selectedDate);
            
            if (calendarMode === 'english') {
                formDatePrimary.textContent = formatEnglishDate(selectedDate);
                formDateSecondary.textContent = formatNepaliDate(nepaliDate);
            } else {
                const nepaliWeekday = nepaliWeekdays[selectedDate.getDay()];
                formDatePrimary.textContent = `${nepaliMonths[nepaliDate.month - 1]} ${toNepaliNumerals(nepaliDate.day)}, ${toNepaliNumerals(nepaliDate.year)}, ${nepaliWeekday}`;
                
                const weekday = selectedDate.toLocaleDateString('en-US', { weekday: 'short' });
                formDateSecondary.textContent = `${selectedDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })} (${weekday})`;
            }
        }
        
        function showDateModal(date) {
            if (!date || !(date instanceof Date) || isNaN(date.getTime())) {
                showNotification('Invalid date selected', 'error');
                return;
            }
            
            selectedDate = date;
            const nepaliDate = getNepaliDateFromEnglish(date);
            
            if (calendarMode === 'english') {
                modalDatePrimary.textContent = formatEnglishDate(date);
                modalDateSecondary.textContent = formatNepaliDate(nepaliDate);
            } else {
                const nepaliWeekday = nepaliWeekdays[date.getDay()];
                modalDatePrimary.textContent = `${nepaliMonths[nepaliDate.month - 1]} ${toNepaliNumerals(nepaliDate.day)}, ${toNepaliNumerals(nepaliDate.year)}, ${nepaliWeekday}`;
                
                const weekday = date.toLocaleDateString('en-US', { weekday: 'short' });
                modalDateSecondary.textContent = `${date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })} (${weekday})`;
            }
            
            loadEntriesForModal(date);
            dateModal.classList.add('active');
            document.body.classList.add('modal-open');
        }
        
        function closeDateModal() {
            dateModal.classList.remove('active');
            document.body.classList.remove('modal-open');
            renderCalendar();
        }
        
        function loadEntriesForModal(date) {
            const entries = getEntriesForDate(date);
            entriesContainer.innerHTML = '';
            
            if (entries.length === 0) {
                entriesContainer.innerHTML = `
                    <div class="no-entries">
                        <i class="fas fa-calendar-plus" style="font-size: 3rem; margin-bottom: 15px; color: #ccc;"></i>
                        <p>No entries for this date yet.</p>
                        <p>Click "Add Entry" button to add your first entry!</p>
                    </div>
                `;
                return;
            }
            
            entries.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            entries.forEach(entry => {
                const entryElement = document.createElement('div');
                entryElement.className = 'entry-item';
                entryElement.dataset.id = entry.id;
                
                const entryTypeInfo = entryTypes[entry.type] || entryTypes.note;
                entryElement.style.borderLeftColor = entryTypeInfo.color;
                
                const entryTime = new Date(entry.timestamp);
                const timeString = entryTime.toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: true 
                });
                
                entryElement.innerHTML = `
                    <div class="entry-item-header">
                        <span class="entry-type" style="background-color: ${entryTypeInfo.color}">
                            <i class="${entryTypeInfo.icon}"></i> ${entryTypeInfo.name}
                        </span>
                        <span class="entry-time">${timeString}</span>
                    </div>
                    <h4 style="margin-bottom: 8px; color: #333;">${entry.title}</h4>
                    <div class="entry-content">${entry.details}</div>
                    <div class="entry-actions">
                        <button class="entry-btn edit-btn" data-action="edit" data-id="${entry.id}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="entry-btn delete-btn" data-action="delete" data-id="${entry.id}">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                
                entriesContainer.appendChild(entryElement);
            });
            
            document.querySelectorAll('.entry-btn[data-action="edit"]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const entryId = e.currentTarget.dataset.id;
                    closeDateModal();
                    setTimeout(() => {
                        showEntryFormModal(true, entryId);
                    }, 300);
                });
            });
            
            document.querySelectorAll('.entry-btn[data-action="delete"]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const entryId = e.currentTarget.dataset.id;
                    if (confirm('Are you sure you want to delete this entry? This action cannot be undone.')) {
                        const success = deleteEntryFromDate(date, entryId);
                        
                        if (success) {
                            loadEntriesForModal(date);
                            showNotification('Entry deleted successfully', 'success');
                        } else {
                            showNotification('Failed to delete entry', 'error');
                        }
                    }
                });
            });
        }

        // =================== CALENDAR FUNCTIONS ===================
        
        function toggleCalendarMode(mode) {
            calendarMode = mode;
            
            englishDateBtn.classList.toggle('active', mode === 'english');
            nepaliDateBtn.classList.toggle('active', mode === 'nepali');
            
            if (mode === 'nepali') {
                weekdaysElement.innerHTML = nepaliWeekdays.map(day => `<div>${day}</div>`).join('');
            } else {
                weekdaysElement.innerHTML = englishWeekdays.map(day => `<div>${day}</div>`).join('');
            }
            
            renderCalendar();
        }
        
        function renderCalendar() {
            calendarGridElement.innerHTML = '';
            
            if (calendarMode === 'english') {
                renderEnglishCalendar();
            } else {
                renderNepaliCalendar();
            }
        }
        
        function renderEnglishCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            monthYearElement.textContent = `${englishMonths[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startDay = firstDay.getDay();
            
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            
            for (let i = 0; i < 42; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                let dayNumber;
                let date;
                
                if (i < startDay) {
                    dayNumber = prevMonthLastDay - startDay + i + 1;
                    date = new Date(year, month - 1, dayNumber);
                    dayElement.classList.add('other-month');
                } else if (i >= startDay && i < startDay + daysInMonth) {
                    dayNumber = i - startDay + 1;
                    date = new Date(year, month, dayNumber);
                    dayElement.classList.add('current-month');
                    
                    // Check if this is today
                    const today = new Date();
                    if (date.getDate() === today.getDate() && 
                        date.getMonth() === today.getMonth() && 
                        date.getFullYear() === today.getFullYear()) {
                        dayElement.classList.add('today');
                    }
                    
                    if (selectedDate && 
                        date.getDate() === selectedDate.getDate() && 
                        date.getMonth() === selectedDate.getMonth() && 
                        date.getFullYear() === selectedDate.getFullYear()) {
                        dayElement.classList.add('selected-day');
                    }
                } else {
                    dayNumber = i - startDay - daysInMonth + 1;
                    date = new Date(year, month + 1, dayNumber);
                    dayElement.classList.add('other-month');
                }
                
                const entryCount = getEntryCountForDate(date);
                if (entryCount > 0) {
                    dayElement.classList.add('has-entries');
                }
                
                const nepaliDate = getNepaliDateFromEnglish(date);
                
                const primaryDate = document.createElement('div');
                primaryDate.className = 'primary-date';
                primaryDate.textContent = dayNumber;
                
                const secondaryDate = document.createElement('div');
                secondaryDate.className = 'secondary-date';
                secondaryDate.textContent = `${toNepaliNumerals(nepaliDate.day)} ${nepaliMonths[nepaliDate.month - 1]}`;
                
                dayElement.appendChild(primaryDate);
                dayElement.appendChild(secondaryDate);
                
                if (entryCount > 0) {
                    const entryCountElement = document.createElement('div');
                    entryCountElement.className = 'entry-count';
                    entryCountElement.textContent = `${entryCount}`;
                    dayElement.appendChild(entryCountElement);
                }
                
                dayElement.addEventListener('click', () => {
                    showDateModal(date);
                });
                
                calendarGridElement.appendChild(dayElement);
            }
        }
        
        function renderNepaliCalendar() {
            const nepaliDate = getNepaliDateFromEnglish(currentDate);
            let nepaliYear = nepaliDate.year;
            let nepaliMonth = nepaliDate.month;
            
            monthYearElement.textContent = `${nepaliMonths[nepaliMonth - 1]} ${toNepaliNumerals(nepaliYear)}`;
            
            const yearData = nepaliCalendarData[nepaliYear];
            if (!yearData) {
                calendarGridElement.innerHTML = `<div class="no-entries">Data not available for this year</div>`;
                return;
            }
            
            const daysInMonth = yearData.months[nepaliMonth - 1];
            const firstDayEnglish = getEnglishDateFromNepali(nepaliYear, nepaliMonth, 1);
            const startDay = firstDayEnglish.getDay();
            
            let prevNepaliYear = nepaliYear;
            let prevNepaliMonth = nepaliMonth - 1;
            if (prevNepaliMonth < 1) {
                prevNepaliMonth = 12;
                prevNepaliYear--;
            }
            
            const prevYearData = nepaliCalendarData[prevNepaliYear];
            const prevMonthDays = prevYearData ? prevYearData.months[prevNepaliMonth - 1] : 30;
            
            for (let i = 0; i < 42; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                let nepaliDay;
                let englishDate;
                
                if (i < startDay) {
                    nepaliDay = prevMonthDays - startDay + i + 1;
                    englishDate = getEnglishDateFromNepali(prevNepaliYear, prevNepaliMonth, nepaliDay);
                    dayElement.classList.add('other-month');
                } else if (i >= startDay && i < startDay + daysInMonth) {
                    nepaliDay = i - startDay + 1;
                    englishDate = getEnglishDateFromNepali(nepaliYear, nepaliMonth, nepaliDay);
                    dayElement.classList.add('current-month');
                    
                    // Check if this is today
                    const today = new Date();
                    if (englishDate.getDate() === today.getDate() && 
                        englishDate.getMonth() === today.getMonth() && 
                        englishDate.getFullYear() === today.getFullYear()) {
                        dayElement.classList.add('today');
                    }
                    
                    if (selectedDate && 
                        englishDate.getDate() === selectedDate.getDate() && 
                        englishDate.getMonth() === selectedDate.getMonth() && 
                        englishDate.getFullYear() === selectedDate.getFullYear()) {
                        dayElement.classList.add('selected-day');
                    }
                } else {
                    nepaliDay = i - startDay - daysInMonth + 1;
                    let nextNepaliMonth = nepaliMonth + 1;
                    let nextNepaliYear = nepaliYear;
                    
                    if (nextNepaliMonth > 12) {
                        nextNepaliMonth = 1;
                        nextNepaliYear++;
                    }
                    
                    englishDate = getEnglishDateFromNepali(nextNepaliYear, nextNepaliMonth, nepaliDay);
                    dayElement.classList.add('other-month');
                }
                
                const entryCount = getEntryCountForDate(englishDate);
                if (entryCount > 0) {
                    dayElement.classList.add('has-entries');
                }
                
                const primaryDate = document.createElement('div');
                primaryDate.className = 'primary-date';
                primaryDate.textContent = toNepaliNumerals(nepaliDay);
                
                const englishDateForDisplay = new Date(englishDate);
                const englishMonthShort = englishMonths[englishDateForDisplay.getMonth()].substring(0, 3);
                const englishDayNum = englishDateForDisplay.getDate();
                
                const secondaryDate = document.createElement('div');
                secondaryDate.className = 'secondary-date';
                secondaryDate.textContent = `${englishMonthShort} ${englishDayNum}`;
                
                dayElement.appendChild(primaryDate);
                dayElement.appendChild(secondaryDate);
                
                if (entryCount > 0) {
                    const entryCountElement = document.createElement('div');
                    entryCountElement.className = 'entry-count';
                    entryCountElement.textContent = toNepaliNumerals(entryCount);
                    dayElement.appendChild(entryCountElement);
                }
                
                dayElement.addEventListener('click', () => {
                    showDateModal(englishDate);
                });
                
                calendarGridElement.appendChild(dayElement);
            }
        }
        
        // =================== EVENT LISTENERS ===================
        
        function setupEventListeners() {
            // Calendar navigation
            prevMonthButton.addEventListener('click', () => {
                if (calendarMode === 'english') {
                    currentDate.setMonth(currentDate.getMonth() - 1);
                } else {
                    const nepaliDate = getNepaliDateFromEnglish(currentDate);
                    let newNepaliMonth = nepaliDate.month - 1;
                    let newNepaliYear = nepaliDate.year;
                    
                    if (newNepaliMonth < 1) {
                        newNepaliMonth = 12;
                        newNepaliYear--;
                    }
                    
                    const newEnglishDate = getEnglishDateFromNepali(newNepaliYear, newNepaliMonth, 15);
                    currentDate = newEnglishDate;
                }
                renderCalendar();
            });
            
            nextMonthButton.addEventListener('click', () => {
                if (calendarMode === 'english') {
                    currentDate.setMonth(currentDate.getMonth() + 1);
                } else {
                    const nepaliDate = getNepaliDateFromEnglish(currentDate);
                    let newNepaliMonth = nepaliDate.month + 1;
                    let newNepaliYear = nepaliDate.year;
                    
                    if (newNepaliMonth > 12) {
                        newNepaliMonth = 1;
                        newNepaliYear++;
                    }
                    
                    const newEnglishDate = getEnglishDateFromNepali(newNepaliYear, newNepaliMonth, 15);
                    currentDate = newEnglishDate;
                }
                renderCalendar();
            });
            
            // Date toggle buttons
            englishDateBtn.addEventListener('click', () => toggleCalendarMode('english'));
            nepaliDateBtn.addEventListener('click', () => toggleCalendarMode('nepali'));
            
            // All entries button
            allEntriesBtn.addEventListener('click', showAllEntriesModal);
            
            // Modal close buttons
            modalClose.addEventListener('click', closeDateModal);
            allEntriesClose.addEventListener('click', closeAllEntriesModal);
            entryFormClose.addEventListener('click', closeEntryFormModal);
            cancelEntry.addEventListener('click', closeEntryFormModal);
            
            // Close modals on overlay click
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        closeDateModal();
                        closeAllEntriesModal();
                        closeEntryFormModal();
                    }
                });
            });
            
            // Show entry form
            showEntryFormBtn.addEventListener('click', () => {
                closeDateModal();
                setTimeout(() => {
                    showEntryFormModal(false, null);
                }, 300);
            });
            
            // Handle entry form submission
            entryForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                if (!selectedDate) {
                    showNotification('Please select a date first', 'error');
                    return;
                }
                
                const entryData = {
                    type: entryType.value,
                    title: entryTitle.value.trim(),
                    details: entryDetails.value.trim()
                };
                
                if (!entryData.title || !entryData.details) {
                    showNotification('Please fill in both title and details', 'error');
                    return;
                }
                
                if (currentEntryId) {
                    // Update existing entry
                    const success = updateEntryForDate(selectedDate, currentEntryId, entryData);
                    
                    if (success) {
                        showNotification('Entry updated successfully', 'success');
                        closeEntryFormModal();
                        setTimeout(() => {
                            showDateModal(selectedDate);
                        }, 300);
                    } else {
                        showNotification('Failed to update entry', 'error');
                    }
                } else {
                    // Add new entry
                    addEntryToDate(selectedDate, entryData);
                    showNotification('Entry added successfully', 'success');
                    closeEntryFormModal();
                    setTimeout(() => {
                        showDateModal(selectedDate);
                    }, 300);
                }
            });
            
            // Search in all entries modal
            searchAllEntries.addEventListener('input', (e) => {
                const query = e.target.value;
                const activeFilter = document.querySelector('.filter-btn.active');
                const filterType = activeFilter ? activeFilter.dataset.filter : 'all';
                loadAllEntries(filterType, query);
            });
            
            // Filter buttons in all entries modal
            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    const filterType = button.dataset.filter;
                    const searchQuery = searchAllEntries.value;
                    loadAllEntries(filterType, searchQuery);
                });
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeDateModal();
                    closeAllEntriesModal();
                    closeEntryFormModal();
                }
                
                if (e.key === 'ArrowLeft' && !document.querySelector('.modal-overlay.active')) {
                    prevMonthButton.click();
                }
                
                if (e.key === 'ArrowRight' && !document.querySelector('.modal-overlay.active')) {
                    nextMonthButton.click();
                }
            });
        }
        
        // =================== INITIALIZATION ===================
        
        function initializeApp() {
            // Load saved entries
            loadEntries();
            
            // Setup initial display
            toggleCalendarMode('english');
            
            // Setup event listeners
            setupEventListeners();
            
            // Start the daily date update system
            startDailyDateUpdates();
            
            // Initialize TODAY with correct time
            TODAY = new Date();
            currentDate = new Date(TODAY);
            
            // Show notification if there are entries
            const allEntries = getAllEntries();
            if (allEntries.length > 0) {
                setTimeout(() => {
                    showNotification(`Welcome back! You have ${allEntries.length} journal entries.`, 'info', 4000);
                }, 1000);
            } else {
                setTimeout(() => {
                    showNotification('Click on any date to add your first journal entry!', 'info', 5000);
                }, 1000);
            }
            
            console.log('Work Journal App initialized successfully!');
        }
        
        // =================== RUN ON LOAD ===================
        
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
        });
    </script>
</body>
</html>
